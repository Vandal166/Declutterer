<Window
    Height="700"
    Icon="/Assets/avalonia-logo.ico"
    Title="Scan Options"
    Width="450"
    WindowStartupLocation="CenterScreen"
    d:DesignHeight="700"
    d:DesignWidth="450"
    mc:Ignorable="d"
    x:Class="Declutterer.Views.ScanOptionsWindow"
    x:DataType="viewModels:ScanOptionsWindowViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:converters="clr-namespace:Declutterer.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="clr-namespace:Declutterer.ViewModels"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Design.DataContext>
        <!--
            This only sets the DataContext for the previewer in an IDE,
            to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs)
        -->
        <viewModels:ScanOptionsWindowViewModel />
    </Design.DataContext>

    <DockPanel>
        <StackPanel
            DockPanel.Dock="Bottom"
            HorizontalAlignment="Right"
            Margin="20,16,20,20"
            Orientation="Horizontal"
            Spacing="8">
            <Button
                Command="{Binding CancelCommand}"
                Content="Cancel"
                IsCancel="True"
                MinWidth="80" />
            <Button
                Background="CornflowerBlue"
                Command="{Binding ScanCommand}"
                Content="Scan"
                IsDefault="True"
                MinWidth="80" />
        </StackPanel>

        <ScrollViewer DockPanel.Dock="Top">
            <StackPanel Margin="20" Spacing="16">

                <!--  Title  -->
                <TextBlock
                    FontSize="18"
                    FontWeight="Bold"
                    Text="Configure Scan" />

                <!--  Locations  -->
                <HeaderedContentControl Classes="indented" Header="Locations">
                    <StackPanel Spacing="8">
                        <CheckBox Content="Desktop" IsChecked="{Binding IsDesktopSelected}" />
                        <CheckBox Content="Downloads" IsChecked="{Binding IsDownloadsSelected}" />
                        <CheckBox Content="Documents" IsChecked="{Binding IsDocumentsSelected}" />

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <Button Command="{Binding AddDirectoryCommand}" Content="Add Folder…" />
                            <TextBlock
                                FontSize="12"
                                Opacity="0.7"
                                Text="Custom folders supported"
                                VerticalAlignment="Center" />
                        </StackPanel>

                        <!--  Added Directories List  -->
                        <ItemsControl ItemsSource="{Binding ScanOptions.DirectoriesToScan}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border
                                        Background="{DynamicResource ThemeBackgroundBrush}"
                                        BorderBrush="{DynamicResource ThemeBorderMidBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8,6">
                                        <Grid ColumnDefinitions="*,Auto">
                                            <TextBlock
                                                FontSize="12"
                                                Grid.Column="0"
                                                Text="{Binding Converter={StaticResource PathMiddleEllipsisConverter}, ConverterParameter=50}"
                                                VerticalAlignment="Center" />
                                            <Button
                                                Background="Azure"
                                                BorderBrush="#FF999999"
                                                BorderThickness="1"
                                                Command="{Binding $parent[ItemsControl].DataContext.RemoveDirectoryCommand}"
                                                CommandParameter="{Binding}"
                                                Content="✕"
                                                CornerRadius="4"
                                                FontSize="18"
                                                Foreground="Black"
                                                Grid.Column="1"
                                                HorizontalAlignment="Center"
                                                HorizontalContentAlignment="Center"
                                                Margin="0"
                                                MinHeight="28"
                                                MinWidth="28"
                                                Padding="0"
                                                VerticalAlignment="Center"
                                                VerticalContentAlignment="Center" />
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!--  Error Message  -->
                        <TextBlock
                            FontSize="12"
                            Foreground="Red"
                            IsVisible="{Binding DirectorySelectionError, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                            Text="{Binding DirectorySelectionError}"
                            TextWrapping="Wrap" />
                    </StackPanel>
                </HeaderedContentControl>

                <!--  Age Rules  -->
                <HeaderedContentControl Classes="indented" Header="Age Filters">
                    <StackPanel Spacing="8">

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <CheckBox HorizontalAlignment="Center" IsChecked="{Binding ScanOptions.AgeFilter.UseModifiedDate}" />
                            <TextBlock Text="Not modified in last" VerticalAlignment="Center" />
                            <NumericUpDown
                                ClipValueToMinMax="True"
                                FormatString="N0"
                                MaxWidth="160"
                                Maximum="120"
                                MinWidth="120"
                                Minimum="1"
                                Value="{Binding ScanOptions.AgeFilter.MonthsModifiedValue}"
                                VerticalAlignment="Center" />
                            <TextBlock Text="months" VerticalAlignment="Center" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <CheckBox IsChecked="{Binding ScanOptions.AgeFilter.UseAccessedDate}" VerticalAlignment="Center" />
                            <TextBlock Text="Not accessed in last" VerticalAlignment="Center" />
                            <NumericUpDown
                                ClipValueToMinMax="True"
                                FormatString="N0"
                                MaxWidth="160"
                                Maximum="120"
                                MinWidth="120"
                                Minimum="1"
                                Value="{Binding ScanOptions.AgeFilter.MonthsAccessedValue}"
                                VerticalAlignment="Center" />
                            <TextBlock Text="months" VerticalAlignment="Center" />
                        </StackPanel>

                        <TextBlock
                            FontSize="11"
                            Opacity="0.6"
                            Text="Access time may be unreliable on some systems" />
                    </StackPanel>
                </HeaderedContentControl>

                <!--  Size Rules  -->
                <HeaderedContentControl Classes="indented" Header="Size Filters">
                    <StackPanel Spacing="8">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <CheckBox IsChecked="{Binding ScanOptions.FileSizeFilter.UseSizeFilter}" VerticalAlignment="Center" />
                            <TextBlock Text="Include Files Larger than" VerticalAlignment="Center" />
                            <NumericUpDown
                                FormatString="N0"
                                MaxWidth="250"
                                Maximum="100000"
                                MinWidth="120"
                                Minimum="1"
                                Value="{Binding ScanOptions.FileSizeFilter.SizeThreshold, TargetNullValue=1}" />
                            <TextBlock Text="MB" VerticalAlignment="Center" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <CheckBox IsChecked="{Binding ScanOptions.DirectorySizeFilter.UseSizeFilter}" VerticalAlignment="Center" />
                            <TextBlock Text="Include Folders Larger than" VerticalAlignment="Center" />
                            <NumericUpDown
                                FormatString="N0"
                                MaxWidth="250"
                                Maximum="100000"
                                MinWidth="120"
                                Minimum="1"
                                Value="{Binding ScanOptions.DirectorySizeFilter.SizeThreshold, TargetNullValue=1}" />
                            <TextBlock Text="MB" VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>
                </HeaderedContentControl>

                <!--  Other Options  -->
                <HeaderedContentControl Classes="indented" Header="Other">
                    <StackPanel Spacing="6">
                        <ToggleSwitch Content="Include files" IsChecked="{Binding ScanOptions.IncludeFiles}" />
                        <ToggleSwitch Content="Include empty folders" />
                        <ToggleSwitch Content="Find duplicate files (slow)" />
                    </StackPanel>
                </HeaderedContentControl>

                <!--  Buttons  -->
                <Border
                    Background="{DynamicResource ThemeBorderLowBrush}"
                    Height="1"
                    Margin="0,8" />

            </StackPanel>
        </ScrollViewer>
    </DockPanel>
</Window>
